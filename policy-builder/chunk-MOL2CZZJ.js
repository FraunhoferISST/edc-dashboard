import{a as yt}from"./chunk-72DVIM5O.js";import{$ as z,$a as Dt,B as F,Ba as B,C as f,Da as it,E as L,F as d,Fa as nt,Ga as ot,H as g,Ha as rt,Ia as at,J as P,Ja as ct,K as w,Ka as lt,L as E,M as r,Ma as st,N as o,Na as dt,O as A,Oa as mt,Qa as pt,R as I,Ra as ft,S as u,Sa as ut,T as m,Ta as N,U as Q,V as J,W,Y as a,Ya as Ct,Z as S,_ as T,_a as _t,ab as vt,bb as ht,d as D,da as H,db as gt,e as O,fa as y,g as V,ga as b,h as v,j as $,ka as K,la as X,m as q,ma as k,na as M,o as R,p as U,r as G,s as C,t as _,ta as Y,va as Z,w as x,wa as j,xa as tt,y as c,ya as et,z as h}from"./chunk-NSHOW2UM.js";var xt=["assetsSelector"];function wt(i,s){i&1&&(r(0,"span",19),a(1,"Optional"),o())}function Et(i,s){if(i&1&&(r(0,"option",22),a(1),o()),i&2){let t=s.$implicit;d("ngValue",t.id),c(),S(t.id)}}function At(i,s){i&1&&(r(0,"p",23),a(1,"Mandatory"),o())}function Vt(i,s){if(i&1&&(r(0,"option",22),a(1),o()),i&2){let t=s.$implicit;d("ngValue",t.id),c(),S(t.id)}}function Ft(i,s){i&1&&(r(0,"p",23),a(1,"Mandatory"),o())}function Pt(i,s){if(i&1&&(r(0,"fieldset",3)(1,"legend",4),a(2,"Policy Selections"),o(),r(3,"legend",5),a(4,"Access Policy"),o(),r(5,"label",20)(6,"span",7),a(7,"policy"),o(),r(8,"select",21),w(9,Et,2,2,"option",22,P),y(11,"async"),o()(),f(12,At,2,0,"p",23),r(13,"legend",5),a(14,"Contract Policy"),o(),r(15,"label",20)(16,"span",7),a(17,"policy"),o(),r(18,"select",24),w(19,Vt,2,2,"option",22,P),y(21,"async"),o()(),f(22,Ft,2,0,"p",23),o()),i&2){let t,n,e,l,p=m();c(5),d("ngClass",(t=p.contractDefinitionForm.get("accessPolicyId"))!=null&&t.invalid?"select-error":""),c(4),E(b(11,4,p.policyDefinitions$)),c(3),g((n=p.contractDefinitionForm.get("accessPolicyId"))!=null&&n.invalid?12:-1),c(3),d("ngClass",(e=p.contractDefinitionForm.get("contractPolicyId"))!=null&&e.invalid?"select-error":""),c(4),E(b(21,6,p.policyDefinitions$)),c(3),g((l=p.contractDefinitionForm.get("contractPolicyId"))!=null&&l.invalid?22:-1)}}function $t(i,s){if(i&1){let t=I();r(0,"div",10)(1,"div",25)(2,"button",26),u("click",function(){C(t);let e=m();return _(e.createPolicy())}),r(3,"span",18),a(4,"policy"),o(),a(5," Policy View "),o()()()}}function Tt(i,s){if(i&1){let t=I();r(0,"lib-multiselect-with-search",27,0),u("selectedItemsChange",function(e){C(t);let l=m();return _(l.handleSelectionChange(e))}),o()}if(i&2){let t=s.ngIf,n=m();d("items",t)("preSelectedItems",n.assetInput)}}function kt(i,s){i&1&&A(0,"div",13)}function Mt(i,s){if(i&1&&(r(0,"div",14)(1,"span",28),a(2,"check"),o(),r(3,"span",29),a(4),o()()),i&2){let t=s.$implicit;c(4),T("ID = ",t,"")}}function jt(i,s){if(i&1){let t=I();r(0,"lib-alert",30),u("closeEvent",function(){C(t);let e=m();return _(e.errorMsg="")}),o()}if(i&2){let t=m();d("msg",t.errorMsg)}}function Bt(i,s){if(i&1&&(r(0,"div",13)(1,"span",14),a(2,"check"),o(),r(3,"span",8),a(4),o()()),i&2){let t=s.$implicit;c(4),z("",t.operandLeft," ",t.operator," ",t.operandRight,"")}}function Nt(i,s){if(i&1&&(r(0,"details",9)(1,"summary",11)(2,"div",6)(3,"span",7),a(4,"rule"),o(),r(5,"b")(6,"i"),a(7,"Asset Selection"),o()()()(),f(8,Bt,5,3,"div",12),o()),i&2){let t=m();c(8),d("ngForOf",t.contractDefinition.assetsSelector)}}function Ot(i,s){i&1&&(r(0,"div",6)(1,"span",7),a(2,"rule"),o(),r(3,"b")(4,"i"),a(5,"Asset Selection"),o()()(),r(6,"span",15),a(7,"All assets"),o())}function qt(i,s){if(i&1){let t=I();r(0,"div",16)(1,"div",17)(2,"button",18),u("click",function(){C(t);let e=m();return _(e.openDetailsEvent.emit(e.contractDefinition))}),r(3,"i",19),a(4,"info"),o()()(),r(5,"div",20)(6,"button",21),u("click",function(){C(t);let e=m();return _(e.editContractDefinitionEvent.emit(e.contractDefinition))}),r(7,"i",19),a(8,"edit"),o()()(),r(9,"div",22)(10,"button",23),u("click",function(){C(t);let e=m();return _(e.deleteContractDefinitionEvent.emit(e.contractDefinition))}),r(11,"i",19),a(12,"delete"),o()()()()}}var Rt=()=>["Alt","j"],Ut=(i,s)=>s.id;function Gt(i,s){if(i&1){let t=I();r(0,"lib-contract-definition-card",9),u("openDetailsEvent",function(e){C(t);let l=m();return _(l.openDetails(e))})("editContractDefinitionEvent",function(e){C(t);let l=m();return _(l.editContractDefinition(e))})("deleteContractDefinitionEvent",function(e){C(t);let l=m();return _(l.deleteContractDefinition(e))}),o()}if(i&2){let t=s.$implicit;d("contractDefinition",t)}}function Lt(i,s){i&1&&A(0,"span",10)}function Qt(i,s){if(i&1){let t=I();r(0,"div",11)(1,"button",12),u("click",function(){C(t);let e=m(2);return _(e.createContractDefinition())}),r(2,"span",3),a(3,"add"),o(),a(4," Create "),o()()}}function Jt(i,s){if(i&1&&(r(0,"div",8),f(1,Lt,1,0,"span",10)(2,Qt,5,0,"div",11),o()),i&2){let t=m();c(),g(t.fetched?2:1)}}var St=(()=>{class i{edc;constructor(t){this.edc=t}getAllContractDefinitions(){return D(this,null,function*(){return(yield this.edc.getClient()).management.contractDefinitions.queryAll()})}createContractDefinition(t){return D(this,null,function*(){return(yield this.edc.getClient()).management.contractDefinitions.create(t)})}updateContractDefinition(t){return D(this,null,function*(){return(yield this.edc.getClient()).management.contractDefinitions.update(t)})}deleteContractDefinition(t){return D(this,null,function*(){return(yield this.edc.getClient()).management.contractDefinitions.delete(t.id)})}getAllPolicies(){return D(this,null,function*(){return(yield this.edc.getClient()).management.policyDefinitions.queryAll()})}static \u0275fac=function(n){return new(n||i)(U(pt))};static \u0275prov=R({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),bt=(()=>{class i{router;contractDefinitionService;assetService;formBuilder;modalAndAlertService;searchChild;contractDefinitionInput;createdEvent=new x;editedEvent=new x;contractDefinitionForm;contractDefinitionId="";accessPolicyId="";contractPolicyId="";assetInput=[];assets$=v([]);assetIds$=v([]);policyDefinitions$=v([]);errorMsg="";constructor(t,n,e,l,p){this.router=t,this.contractDefinitionService=n,this.assetService=e,this.formBuilder=l,this.modalAndAlertService=p,this.contractDefinitionForm=this.formBuilder.group({id:[""],accessPolicyId:new B(void 0,{validators:[j.required]}),contractPolicyId:new B(void 0,{validators:[j.required]}),assetsSelector:[""]})}ngOnInit(){return D(this,null,function*(){this.assets$=V(this.assetService.getAllAssets()),this.policyDefinitions$=V(this.contractDefinitionService.getAllPolicies()),this.assetIds$=this.assets$.pipe($(t=>t.map(n=>n.id)))})}ngOnChanges(){this.contractDefinitionInput&&(this.contractDefinitionId=this.contractDefinitionInput?.id,this.contractPolicyId=this.contractDefinitionInput?.contractPolicyId,this.accessPolicyId=this.contractDefinitionInput?.accessPolicyId,this.assetInput=this.contractDefinitionInput?.assetsSelector.filter(t=>t.operandLeft=="id").map(t=>t.operandRight),this.syncForm())}syncForm(){this.contractDefinitionInput?.id!==void 0&&(this.contractDefinitionForm.get("id")?.setValue(this.contractDefinitionInput.id),this.contractDefinitionForm.get("id")?.disable()),this.contractDefinitionForm.get("accessPolicyId")?.setValue(this.accessPolicyId),this.contractDefinitionForm.get("contractPolicyId")?.setValue(this.contractPolicyId)}createPolicy(){return D(this,null,function*(){this.modalAndAlertService.closeModal(),yield this.router.navigate(["/policies"])})}handleSelectionChange(t){this.assetInput=t}updateContractDefinition(){let t=this.createContractDefinitionInput();this.contractDefinitionService.updateContractDefinition(t).then(()=>{this.editedEvent.emit()}).catch(n=>{this.errorMsg=n.message})}createContractDefinition(){if(this.contractDefinitionForm.valid){let t=this.createContractDefinitionInput();this.contractDefinitionService.createContractDefinition(t).then(n=>{this.createdEvent.emit(n)}).catch(n=>{this.errorMsg=n.message})}else console.error("Create contract definition called with invalid form")}createContractDefinitionInput(){let t=[];this.assetInput.forEach(e=>{t.push({operandLeft:"id",operandRight:e,operator:"="})});let n={accessPolicyId:this.accessPolicyId,contractPolicyId:this.contractPolicyId,assetsSelector:t};return this.contractDefinitionForm.value.id?n["@id"]=this.contractDefinitionForm.value.id:this.contractDefinitionId&&(n["@id"]=this.contractDefinitionId),this.contractDefinitionForm.value.accessPolicyId&&(n.accessPolicyId=this.contractDefinitionForm.value.accessPolicyId),this.contractDefinitionForm.value.contractPolicyId&&(n.contractPolicyId=this.contractDefinitionForm.value.contractPolicyId),this.contractDefinitionForm.value.assetsSelector&&(n.assetsSelector=this.contractDefinitionForm.value.assetsSelector),n}static \u0275fac=function(n){return new(n||i)(h(Y),h(St),h(yt),h(st),h(N))};static \u0275cmp=F({type:i,selectors:[["lib-contract-definition-create"]],viewQuery:function(n,e){if(n&1&&Q(xt,5),n&2){let l;J(l=W())&&(e.searchChild=l.first)}},inputs:{contractDefinitionInput:"contractDefinitionInput"},outputs:{createdEvent:"createdEvent",editedEvent:"editedEvent"},features:[G],decls:30,vars:16,consts:[["assetsSelector",""],[1,"flex","flex-col","overflow-y-auto","h-full","[&_label]:shrink-0",3,"ngSubmit","formGroup"],[1,"text-xl","text-center","divider","m-0"],[1,"fieldset","w-lg","bg-base-200","border","border-base-300","p-4","rounded-box","mb-4"],[1,"fieldset-legend","text-sm"],[1,"fieldset-label"],[1,"input","input-bordered","!border-[var(--input-color)]","flex","items-center","w-full",3,"ngClass"],[1,"material-symbols-rounded","opacity-50"],["type","text","placeholder","ID","formControlName","id","name","id",1,"grow"],["class","badge badge-info",4,"ngIf"],[1,"skeleton","flex","justify-center","items-center","h-56","rounded-2xl","mb-3","mt-1"],[1,"fieldset","w-lg","bg-base-200","border","border-base-300","p-4","rounded-box"],["class","w-full",3,"items","preSelectedItems","selectedItemsChange",4,"ngIf"],[1,"pt-3"],[1,"flex","items-center","ml-4"],[1,"divider"],["title","Error","type","error","class","w-lg mb-4",3,"msg","closeEvent",4,"ngIf"],["type","submit",1,"btn","btn-lg","w-lg",3,"disabled","ngClass"],[1,"material-symbols-rounded"],[1,"badge","badge-info"],[1,"select","w-full",3,"ngClass"],["formControlName","accessPolicyId","name","accessPolicyId","required",""],[3,"ngValue"],[1,"fieldset-label","text-error"],["formControlName","contractPolicyId","name","contractPolicyId","required",""],["data-tip","No policies yet! Create a policy first before adding a contract definition.",1,"tooltip","tooltip-open","tooltip-primary"],["type","button",1,"btn","btn-primary","btn-dash",3,"click"],[1,"w-full",3,"selectedItemsChange","items","preSelectedItems"],[1,"material-symbols-rounded","mr-2"],[1,"truncate"],["title","Error","type","error",1,"w-lg","mb-4",3,"closeEvent","msg"]],template:function(n,e){if(n&1&&(r(0,"form",1),u("ngSubmit",function(){return e.contractDefinitionInput?e.updateContractDefinition():e.createContractDefinition()}),r(1,"h1",2),a(2,"Contract Definition"),o(),r(3,"fieldset",3)(4,"legend",4),a(5,"Common Fields"),o(),r(6,"legend",5),a(7,"ID"),o(),r(8,"label",6)(9,"span",7),a(10,"contract_edit"),o(),A(11,"input",8),f(12,wt,2,0,"span",9),o()(),f(13,Pt,23,8,"fieldset",3),y(14,"async"),f(15,$t,6,0,"div",10),r(16,"fieldset",11)(17,"legend",4),a(18,"Asset Selection"),o(),f(19,Tt,2,2,"lib-multiselect-with-search",12),y(20,"async"),f(21,kt,1,0,"div",13),w(22,Mt,5,1,"div",14,P),o(),A(24,"div",15),f(25,jt,1,1,"lib-alert",16),r(26,"button",17)(27,"i",18),a(28),o(),a(29),o()()),n&2){let l;d("formGroup",e.contractDefinitionForm),c(8),d("ngClass",e.contractDefinitionInput?"":"tooltip tooltip-info tooltip-top"),L("data-tip",e.contractDefinitionInput?"":"If not set a random UUID will be generated"),c(4),d("ngIf",!e.contractDefinitionInput),c(),g((l=(l=b(14,12,e.policyDefinitions$))==null?null:l.length)!==null&&l!==void 0&&l?13:15),c(6),d("ngIf",b(20,14,e.assetIds$)),c(2),g(e.assetInput.length>0?21:-1),c(),E(e.assetInput),c(3),d("ngIf",e.errorMsg),c(),d("disabled",e.contractDefinitionForm.invalid)("ngClass",e.contractDefinitionInput?"btn-warning":"btn-primary"),c(2),S(e.contractDefinitionInput?"update":"add"),c(),T(" ",e.contractDefinitionInput?"Update":"Create"," Contract Definition ")}},dependencies:[dt,it,at,ct,Z,rt,tt,et,lt,gt,ut,mt,nt,ot,M,K,k],encapsulation:2})}return i})(),It=(()=>{class i{contractDefinition;showButtons=!0;openDetailsEvent=new x;editContractDefinitionEvent=new x;deleteContractDefinitionEvent=new x;static \u0275fac=function(n){return new(n||i)};static \u0275cmp=F({type:i,selectors:[["lib-contract-definition-card"]],inputs:{contractDefinition:"contractDefinition",showButtons:"showButtons"},outputs:{openDetailsEvent:"openDetailsEvent",editContractDefinitionEvent:"editContractDefinitionEvent",deleteContractDefinitionEvent:"deleteContractDefinitionEvent"},decls:27,vars:5,consts:[[1,"card","grow","bg-base-300","relative"],[1,"card-body"],[1,"card-title","mb-3"],[1,"material-symbols-rounded","text-3xl"],[1,"truncate","text-wrap"],[1,"ml-3","mb-3","grid","grid-cols-[minmax(0,auto)_minmax(0,min-content)]","gap-4"],[1,"flex","items-center"],[1,"material-symbols-rounded","mr-1"],[1,"truncate"],[1,"collapse","collapse-arrow","col-span-2"],["class","card-actions justify-end mt-auto",4,"ngIf"],[1,"collapse-title","p-0","min-h-8","after:top-[0.75rem!important]"],["class","flex items-center py-1",4,"ngFor","ngForOf"],[1,"flex","items-center","py-1"],[1,"material-symbols-rounded","mr-2"],[1,"truncate","text-warning"],[1,"card-actions","justify-end","mt-auto"],["data-tip","Details",1,"tooltip","no-animation"],[1,"btn","btn-soft","btn-primary","btn-circle","btn-sm","no-animation",3,"click"],[1,"material-symbols-rounded"],["data-tip","Edit",1,"tooltip","no-animation"],[1,"btn","btn-soft","btn-warning","btn-circle","btn-sm","no-animation",3,"click"],["data-tip","Delete",1,"tooltip","no-animation"],[1,"btn","btn-soft","btn-error","btn-circle","btn-sm",3,"click"]],template:function(n,e){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),a(4,"contract_edit"),o(),r(5,"span",4),a(6),o()(),r(7,"div",5)(8,"div",6)(9,"span",7),a(10,"policy"),o(),r(11,"b")(12,"i"),a(13,"Access Policy"),o()()(),r(14,"span",8),a(15),o(),r(16,"div",6)(17,"span",7),a(18,"policy"),o(),r(19,"b")(20,"i"),a(21,"Contract Policy"),o()()(),r(22,"span",8),a(23),o(),f(24,Nt,9,1,"details",9)(25,Ot,8,0),o(),f(26,qt,13,0,"div",10),o()()),n&2&&(c(6),S(e.contractDefinition.id),c(9),S(e.contractDefinition.accessPolicyId),c(8),S(e.contractDefinition.contractPolicyId),c(),g(e.contractDefinition.assetsSelector.length!==0?24:25),c(2),d("ngIf",e.showButtons))},dependencies:[X,k],encapsulation:2})}return i})(),le=(()=>{class i{contractDefinitionsService;modalAndAlertService;stateService;destroy$=new O;contractDefinitions$=v([]);filteredContractDefinitions$=v([]);pageContractDefinitions$=v([]);fetched=!1;pageItemCount=15;constructor(t,n,e){this.contractDefinitionsService=t,this.modalAndAlertService=n,this.stateService=e,this.stateService.currentEdcConfig$.pipe(q(this.destroy$)).subscribe(this.fetchContractDefinitions.bind(this))}ngOnInit(){return D(this,null,function*(){this.fetchContractDefinitions()})}fetchContractDefinitions(){this.fetched=!1,this.contractDefinitions$=this.filteredContractDefinitions$=v([]),this.contractDefinitions$=this.filteredContractDefinitions$=V(this.contractDefinitionsService.getAllContractDefinitions().finally(()=>this.fetched=!0))}filter(t){t?this.filteredContractDefinitions$=this.contractDefinitions$.pipe($(n=>n.filter(e=>e.id.includes(t)||e.accessPolicyId.includes(t)||e.contractPolicyId.includes(t)))):this.filteredContractDefinitions$=this.contractDefinitions$}paginationEvent(t){this.pageContractDefinitions$=v(t)}openDetails(t){this.modalAndAlertService?.openModal(_t,{jsonLdObject:t})}createContractDefinition(){let t={createdEvent:n=>{this.modalAndAlertService.closeModal(),this.modalAndAlertService.showAlert(`Contract Definition with ID '${n.id}'`,"Created Successfully","success",5),this.fetchContractDefinitions()}};this.modalAndAlertService.openModal(bt,void 0,t)}editContractDefinition(t){let n={editedEvent:()=>{this.modalAndAlertService.closeModal(),this.modalAndAlertService.showAlert(`Contract Definition with ID '${t.id}'`,"Updated Successfully","success",5),this.fetchContractDefinitions()}};this.modalAndAlertService.openModal(bt,{contractDefinitionInput:t},n)}deleteContractDefinition(t){this.modalAndAlertService.openModal(Ct,{customText:"Do you really want to delete this Contract Definition?",componentType:It,componentInputs:{showButtons:!1,contractDefinition:t}},{canceled:()=>this.modalAndAlertService.closeModal(),confirm:()=>{this.modalAndAlertService.closeModal(),this.contractDefinitionsService.deleteContractDefinition(t).then(()=>{let n=`Contract definition '${t.id}' deleted successfully`;this.modalAndAlertService.showAlert(n,void 0,"success",5),this.fetchContractDefinitions()}).catch(n=>{console.error(n);let e=`Deletion of contract definition '${t.id}' failed`;this.modalAndAlertService.showAlert(e,void 0,"error",5)})}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(n){return new(n||i)(h(St),h(N),h(ft))};static \u0275cmp=F({type:i,selectors:[["lib-contract-definitions-view"]],decls:15,vars:12,consts:[[1,"flex-row","flex-nowrap","flex","mb-4"],["placeholder","Filter for ID ...",1,"mr-4","grow",3,"inputChange","focusShortcut"],[1,"mr-4","btn","btn-lg","btn-primary","rounded-2xl","btn-soft","shadow-xl","!text-sm","border-none",3,"click"],[1,"material-symbols-rounded"],[1,"mr-4",3,"itemCountChanged","currentItemCount"],[1,"shadow-xl","rounded-2xl","bg-base-300","[&_button:hover]:bg-base-100","[&_.join>button]:first:rounded-l-2xl","[&_.join>button]:last:rounded-r-2xl",3,"pageItems","items","pageItemCount"],[1,"grid","w-full","gap-4","sm:grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","2xl:grid-cols-5"],[1,"shadow-xl","rounded-2xl","[&_>.card]:h-full",3,"contractDefinition"],[1,"skeleton","flex","justify-center","items-center","h-72","shadow-xl","rounded-2xl"],[1,"shadow-xl","rounded-2xl","[&_>.card]:h-full",3,"openDetailsEvent","editContractDefinitionEvent","deleteContractDefinitionEvent","contractDefinition"],[1,"loading","loading-bars","loading-lg","opacity-75","text-primary"],["data-tip","No contract definitions yet! Create your first ...",1,"tooltip","tooltip-open","tooltip-primary"],[1,"btn","btn-primary","btn-dash",3,"click"]],template:function(n,e){if(n&1&&(r(0,"div",0)(1,"lib-filter-input",1),u("inputChange",function(p){return e.filter(p)}),o(),r(2,"button",2),u("click",function(){return e.createContractDefinition()}),r(3,"i",3),a(4,"add"),o(),a(5," Create "),o(),r(6,"lib-item-count-selector",4),u("itemCountChanged",function(p){return e.pageItemCount=p}),o(),r(7,"lib-pagination",5),y(8,"async"),u("pageItems",function(p){return e.paginationEvent(p)}),o()(),r(9,"div",6),w(10,Gt,1,1,"lib-contract-definition-card",7,Ut),y(12,"async"),f(13,Jt,3,1,"div",8),y(14,"async"),o()),n&2){let l;c(),d("focusShortcut",H(11,Rt)),c(5),d("currentItemCount",e.pageItemCount),c(),d("items",b(8,5,e.filteredContractDefinitions$))("pageItemCount",10),c(3),E(b(12,7,e.pageContractDefinitions$)),c(3),g(((l=b(14,9,e.contractDefinitions$))==null?null:l.length)===0?13:-1)}},dependencies:[M,vt,Dt,It,ht],encapsulation:2})}return i})();export{St as ContractDefinitionsService,le as ContractDefinitionsViewComponent};
