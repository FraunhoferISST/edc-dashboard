import{$a as Nt,Aa as xt,B as D,Ba as B,C as m,Ca as ot,Da as rt,E as $,Ea as yt,F as d,Fa as bt,Ga as St,H as f,Ha as wt,I as mt,Ia as Et,J as R,Ja as It,K as T,Ka as Dt,L as F,M as o,N as a,Na as st,O as b,Oa as Tt,Pa as Bt,Qa as Ft,R as w,Ra as O,S as C,Sa as At,T as p,Ta as L,U as ut,Ua as Vt,V as ft,Va as Pt,W as Ct,Wa as qt,X as _t,Y as s,Z as E,_ as V,_a as Mt,aa as X,ab as $t,ba as Y,bb as Rt,c as jt,ca as tt,d as u,da as k,e as G,ea as et,f as H,fa as _,g as U,ga as h,h as I,i as W,j as ct,k as dt,ka as P,l as K,m as Q,ma as it,n as z,na as q,o as pt,p as gt,r as Z,s as v,t as x,ta as ht,va as nt,w as A,wa as M,xa as j,y as r,ya as at,z as y,za as vt}from"./chunk-NSHOW2UM.js";var S=jt(Bt(),1);function Ot(e,l){e&1&&(o(0,"div",11)(1,"span",12),s(2,"source_environment"),a(),o(3,"b")(4,"i"),s(5,"Provider"),a()()())}function Lt(e,l){if(e&1&&(o(0,"span",13),s(1),a()),e&2){let t=p(3);r(),E(t.participantId)}}function Jt(e,l){e&1&&(o(0,"div",11)(1,"span",12),s(2,"history"),a(),o(3,"b")(4,"i"),s(5,"Version"),a()()())}function Gt(e,l){if(e&1&&(o(0,"span",13),s(1),a()),e&2){let t=p(3);r(),E(t.version)}}function Ht(e,l){e&1&&(o(0,"div",11)(1,"span",12),s(2,"unknown_document"),a(),o(3,"b")(4,"i"),s(5,"Content Type"),a()()())}function Ut(e,l){if(e&1&&(o(0,"span",13),s(1),a()),e&2){let t=p(3);r(),E(t.contentType)}}function Wt(e,l){if(e&1&&(o(0,"div",8),m(1,Ot,6,0,"div",9)(2,Lt,2,1,"span",10)(3,Jt,6,0,"div",9)(4,Gt,2,1,"span",10)(5,Ht,6,0,"div",9)(6,Ut,2,1,"span",10),a()),e&2){let t=p(2);r(),d("ngIf",t.participantId),r(),d("ngIf",t.participantId),r(),d("ngIf",t.version),r(),d("ngIf",t.version),r(),d("ngIf",t.contentType),r(),d("ngIf",t.contentType)}}function Kt(e,l){if(e&1){let t=w();o(0,"div",14)(1,"button",15),C("click",function(){v(t);let n=p(2);return x(n.negotiateEvent.emit(n.catalogDataset))}),o(2,"i",16),s(3,"handshake"),a(),s(4," Negotiate "),a(),o(5,"div",17)(6,"button",18),C("click",function(){v(t);let n=p(2);return x(n.detailsEvent.emit(n.catalogDataset))}),o(7,"i",19),s(8,"info"),a()()()()}}function Qt(e,l){if(e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),s(4,"deployed_code_update"),a(),o(5,"span",5),s(6),a()(),m(7,Wt,7,6,"div",6)(8,Kt,9,0,"div",7),a()()),e&2){let t=p();r(6),E(t.name),r(),d("ngIf",t.participantId||t.version||t.contentType),r(),d("ngIf",t.showButtons)}}var zt=()=>[],Zt=()=>["http://www.w3.org/ns/dcat#distribution","http://www.w3.org/ns/odrl/2/hasPolicy","name","id"],Xt=e=>({"border border-warning/50":e}),Yt=e=>({"border-warning/50":e});function te(e,l){e&1&&b(0,"div",21)}function ee(e,l){if(e&1){let t=w();o(0,"div",17)(1,"label",18)(2,"input",19),tt("ngModelChange",function(n){v(t);let c=p();return Y(c.offerId,n)||(c.offerId=n),x(n)}),C("click",function(){let n=v(t).$implicit,c=p();return x(c.showOfferDetails(n))}),a(),o(3,"span",20),s(4),a()()(),m(5,te,1,0,"div",21)}if(e&2){let t=l.$implicit,i=l.$index,n=l.$count,c=p();r(2),d("id","offer-"+t)("value",t),X("ngModel",c.offerId),r(2),V("Offer ",t,""),r(),f(i!==n-1?5:-1)}}function ie(e,l){if(e&1&&(o(0,"pre")(1,"code",22),s(2),a()()),e&2){let t=l.$implicit,i=l.$index;$("data-prefix",i+1),r(2),E(t)}}function ne(e,l){if(e&1&&(o(0,"div",10),T(1,ie,3,2,"pre",null,mt),_(3,"async"),a()),e&2){let t=p();r(),F(h(3,0,t.selectedOffer))}}function ae(e,l){e&1&&(o(0,"div",11),s(1,"No offer has been selected"),a())}function oe(e,l){if(e&1){let t=w();o(0,"lib-alert",23),C("closeEvent",function(){v(t);let n=p();return x(n.errorMsg="")}),a()}if(e&2){let t=p();d("msg",t.errorMsg)("timeoutSeconds",5)}}function re(e,l){e&1&&(o(0,"legend",4),s(1,"Counter Party DID"),a())}function se(e,l){e&1&&(o(0,"legend",4),s(1,"Counter Party ID"),a())}function le(e,l){e&1&&(o(0,"p",8),s(1,"Mandatory"),a())}function ce(e,l){if(e&1&&(m(0,re,2,0,"legend",4),_(1,"async"),m(2,se,2,0,"legend",4),o(3,"label",5),_(4,"async"),o(5,"span",6),s(6,"link"),a(),b(7,"input",12),_(8,"async"),a(),m(9,le,2,0,"p",8),_(10,"async")),e&2){let t,i,n,c,g=p();f((t=h(1,4,g.stateService.currentEdcConfig$))!=null&&t.did?0:2),r(3),d("ngClass",(i=h(4,6,g.stateService.currentEdcConfig$))!=null&&i.did&&((i=g.requestForm.get("counterPartyId"))!=null&&i.invalid)?"input-error":""),r(4),d("placeholder",(n=h(8,8,g.stateService.currentEdcConfig$))!=null&&n.did?"Counter Party DID":"Counter Party ID"),r(2),f((c=h(10,10,g.stateService.currentEdcConfig$))!=null&&c.did&&((c=g.requestForm.get("counterPartyId"))!=null&&c.invalid)?9:-1)}}function de(e,l){e&1&&(o(0,"p",8),s(1,"Enter a valid URL"),a())}var pe=["connectorSelect"],ge=(e,l)=>l.connectorName;function me(e,l){if(e&1&&(o(0,"option",9),s(1),a()),e&2){let t=p().$implicit;d("ngValue",t),r(),E(t.connectorName)}}function ue(e,l){if(e&1&&(m(0,me,2,2,"option",9),_(1,"async")),e&2){let t=l.$implicit,i=p(2);f(t!==h(1,1,i.stateService.currentEdcConfig$)?0:-1)}}function fe(e,l){if(e&1){let t=w();o(0,"div",3)(1,"select",7,0),C("change",function(){v(t);let n=p();return x(n.getCatalog())}),tt("ngModelChange",function(n){v(t);let c=p();return Y(c.selectedConnector,n)||(c.selectedConnector=n),x(n)}),o(3,"option",8),s(4,"Select ..."),a(),T(5,ue,2,3,null,null,ge),_(7,"async"),a()()}if(e&2){let t=p();d("ngClass",t.showSearchTooltip?"tooltip":""),r(),X("ngModel",t.selectedConnector),r(2),d("ngValue",void 0),r(2),F(h(7,3,t.stateService.edcConfigs$))}}function Ce(e,l){e&1&&(o(0,"div",4),s(1," Federated Catalog Enabled "),a())}function _e(e,l){if(e&1&&(o(0,"li",6),s(1),a()),e&2){let t=l.$implicit,i=p(2);d("ngClass",i.stateHistory.includes(t)?"step-success":""),$("data-content",i.stateHistory.includes(t)?"\u2713":"?"),r(),V(" ",t," ")}}function he(e,l){if(e&1&&T(0,_e,2,3,"li",6,R),e&2){let t=p();F(t.happyPathStates)}}function ve(e,l){if(e&1&&(o(0,"li",6),s(1),a()),e&2){let t=l.$implicit,i=p(2);d("ngClass",i.happyPathStates.includes(t)?"step-success":"step-error before:!bg-error"),$("data-content",i.happyPathStates.includes(t)?"\u2713":"\u2715"),r(),V(" ",t," ")}}function xe(e,l){if(e&1&&T(0,ve,2,3,"li",6,R),e&2){let t=p();F(t.stateHistory)}}function ye(e,l){e&1&&b(0,"span",3)}function be(e,l){if(e&1&&(o(0,"div",4)(1,"span",7),s(2,"error_outline"),a(),o(3,"div",8)(4,"h3",9),s(5,"Error"),a(),o(6,"span"),s(7),a()()()),e&2){let t=p();r(7),E(t.errorMsg)}}function Se(e,l){if(e&1){let t=w();o(0,"div",10),C("click",function(){v(t);let n=p();return x(n.navigateToContracts())}),s(1," Go to Contracts "),o(2,"span",7),s(3,"arrow_forward"),a()()}}var we=()=>["Alt","j"],Ee=(e,l)=>l.id+"-"+l.assetId;function Ie(e,l){e&1&&(o(0,"div",6),b(1,"span",7),a())}function De(e,l){if(e&1&&(o(0,"div",6)(1,"p",8),s(2),a()()),e&2){let t=p(2);r(2),V(" ",t.catalogViewState.emptyCatalogMsg," ")}}function Te(e,l){if(e&1){let t=w();o(0,"lib-catalog-card",10),C("detailsEvent",function(n){v(t);let c=p(3);return x(c.openDetails(n))})("negotiateEvent",function(n){v(t);let c=p(3);return x(c.negotiateContract(n))}),a()}if(e&2){let t=l.$implicit;d("catalogDataset",t)}}function Fe(e,l){if(e&1&&(T(0,Te,1,1,"lib-catalog-card",9,Ee),_(2,"async")),e&2){let t=p(2);F(h(2,0,t.pageCatalogDatasets$))}}function Ae(e,l){if(e&1&&(m(0,De,3,1,"div",6),_(1,"async"),m(2,Fe,3,2)),e&2){let t=p();f(h(1,1,t.hasCatalogDatasets$)===!1?0:2)}}var Ve=(()=>{class e{catalogDataset;showButtons=!0;detailsEvent=new A;negotiateEvent=new A;name;version;contentType;participantId;ngOnInit(){this.name=this.catalogDataset?.assetId,this.version=this.catalogDataset?.dataset?.["asset:prop:version"]?.[0]?.["@value"],this.contentType=this.catalogDataset?.dataset.mandatoryValue("edc","contenttype"),this.participantId=this.catalogDataset?.participantId}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=D({type:e,selectors:[["lib-catalog-card"]],inputs:{catalogDataset:"catalogDataset",showButtons:"showButtons"},outputs:{detailsEvent:"detailsEvent",negotiateEvent:"negotiateEvent"},decls:1,vars:1,consts:[["class","card flex-grow bg-base-300",4,"ngIf"],[1,"card","flex-grow","bg-base-300"],[1,"card-body"],[1,"card-title","mb-3"],[1,"material-symbols-rounded","text-3xl"],[1,"truncate","text-wrap"],["class","ml-3 mb-3 grid grid-cols-[minmax(0,auto)_minmax(0,min-content)] gap-4",4,"ngIf"],["class","card-actions justify-between mt-auto",4,"ngIf"],[1,"ml-3","mb-3","grid","grid-cols-[minmax(0,auto)_minmax(0,min-content)]","gap-4"],["class","flex items-center",4,"ngIf"],["class","truncate",4,"ngIf"],[1,"flex","items-center"],[1,"material-symbols-rounded","mr-1"],[1,"truncate"],[1,"card-actions","justify-between","mt-auto"],[1,"btn","btn-soft","btn-primary","btn-sm","no-animation",3,"click"],[1,"p-0","material-symbols-rounded"],["data-tip","Details",1,"tooltip","no-animation"],[1,"btn","btn-soft","btn-primary","btn-circle","btn-sm","no-animation",3,"click"],[1,"material-symbols-rounded"]],template:function(i,n){i&1&&m(0,Qt,9,3,"div",0),i&2&&d("ngIf",n.catalogDataset)},dependencies:[it],encapsulation:2})}return e})(),lt=(()=>{class e{edc;constructor(t){this.edc=t}getCatalog(t){return u(this,null,function*(){return(yield this.edc.getClient()).management.catalog.request(t)})}getAllFederatedCatalogs(){return u(this,null,function*(){return(yield this.edc.getClient()).federatedCatalog.queryAll()})}initiateNegotiation(t){return u(this,null,function*(){return(yield this.edc.getClient()).management.contractNegotiations.initiate(t)})}getNegotiationState(t){return u(this,null,function*(){return(yield this.edc.getClient()).management.contractNegotiations.getState(t)})}getCatalogDataset(t){return u(this,null,function*(){try{let i=yield this.getCatalog(t);return i.datasets.map(n=>this.generateCatalogDataset(i,n,t.counterPartyAddress))}catch(i){throw i instanceof S.EdcConnectorClientError&&i.type===S.EdcConnectorClientErrorType.BadRequest?new Error("Invalid counter party address. Please check your input and try again."):new Error(`Failed to request catalog from '${t.counterPartyAddress}'`)}})}getAllCatalogDatasets(){return u(this,null,function*(){return(yield this.getAllFederatedCatalogs()).flatMap(i=>i.datasets.map(n=>this.generateCatalogDataset(i,n,i.mandatoryValue("edc","originator"))))})}generateCatalogDataset(t,i,n){let c=this.getCatalogParticipantId(t,n),g=this.getOfferMap(c,i);return{id:t.id,participantId:c,assetId:i.id,dataset:i,offers:g,originator:n}}getCatalogParticipantId(t,i){return t?.["https://w3id.org/dspace/v0.8/participantId"]?.[0]?.["@value"]??i}getOfferMap(t,i){let n=new Map,c="Offer";return i.offers.forEach((g,N)=>{let J={"@type":c,assigner:t,target:i.id},kt=new S.PolicyBuilder().raw(J).raw(g).build();n.set(String(N+1),kt)}),n}static \u0275fac=function(i){return new(i||e)(gt(Ft))};static \u0275prov=pt({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Pe=(()=>{class e{catalogService;catalogDataset;negotiationRequested=new A;dataset={};catalog={};errorMsg="";offerId="";selectedOffer=new H([""]);constructor(t){this.catalogService=t}ngOnChanges(t){return u(this,null,function*(){t.catalogDataset&&(yield this.loadDataset())})}loadDataset(){return u(this,null,function*(){if(this.catalogDataset)try{this.dataset=yield(0,S.compact)(this.catalogDataset.dataset),this.catalog=this.getCatalogAsRecord()}catch(t){console.error("Error compacting dataset:",t)}})}startNegotiation(){let t=this.catalogDataset.offers.get(this.offerId);if(t!=null){let i={counterPartyAddress:this.catalogDataset.originator,policy:t};this.catalogService.initiateNegotiation(i).then(n=>u(this,null,function*(){this.negotiationRequested.emit(n)})).catch(n=>{this.errorMsg=n.message})}else this.errorMsg="No offer selected!"}showOfferDetails(t){return u(this,null,function*(){let i=this.catalogDataset.offers.get(t);if(i!==void 0){let n=["@context","assigner","@type","target"],c=JSON.stringify(i,(g,N)=>{if(!n.includes(g))return N},2).split(`
`);this.selectedOffer.next(c)}})}getCatalogAsRecord(){return{id:this.catalogDataset.id,participantId:this.catalogDataset.participantId,originator:this.catalogDataset.originator}}get offerKeys(){return Array.from(this.catalogDataset.offers.keys())}static \u0275fac=function(i){return new(i||e)(y(lt))};static \u0275cmp=D({type:e,selectors:[["lib-catalog-negotiation"]],inputs:{catalogDataset:"catalogDataset"},outputs:{negotiationRequested:"negotiationRequested"},features:[Z],decls:31,vars:17,consts:[["negotiationForm","ngForm"],[1,"grid","grid-cols-1","2xl:grid-cols-2","gap-4","gap-x-6","items-start","overflow-y-auto","h-full","[&_label]:shrink-0",3,"ngSubmit"],[1,"text-xl","text-center","divider","m-0","2xl:col-span-2"],[1,"flex","flex-col","[&_>*]:mb-4","[&_>*]:last:mb-0"],[1,"fieldset","w-lg","bg-base-200","border","border-base-300","p-4","rounded-box"],[1,"fieldset-legend","text-sm"],[1,"mx-auto",3,"object","excludeKeys","deleteButton"],[1,"flex","flex-col","[&_>*]:mb-4","[&_>*]:last:mb-0","h-full"],[1,"fieldset","w-lg","bg-base-200","border","border-base-300","p-4","rounded-box",3,"ngClass"],[1,"fieldset","w-lg","bg-base-200","border","border-base-300","p-4","rounded-box","h-full",3,"ngClass"],[1,"mockup-code","overflow-auto"],[1,"text-center","text-sm","text-base-content","mt-10","opacity-50"],[1,"2xl:col-span-2","flex","flex-col","items-center"],[1,"divider","mt-0"],["title","Error","type","error","class","max-w-lg 2xl:max-w-xl mb-4",3,"msg","timeoutSeconds","closeEvent",4,"ngIf"],["type","submit",1,"btn","btn-lg","btn-primary","w-lg","2xl:w-xl",3,"disabled"],[1,"material-symbols-rounded"],[1,"group"],[1,"flex","items-center","gap-3","rounded-lg","transition-colors","cursor-pointer","hover:bg-base-200"],["type","radio","name","radioGroup","required","",1,"radio","radio-primary","radio-xs","peer",3,"ngModelChange","click","id","value","ngModel"],[1,"flex-1","text-base-content","peer-checked:font-medium"],[1,"border-t","border-base-300","-mx-2"],[1,"compact","text-xs"],["title","Error","type","error",1,"max-w-lg","2xl:max-w-xl","mb-4",3,"closeEvent","msg","timeoutSeconds"]],template:function(i,n){if(i&1){let c=w();o(0,"form",1,0),C("ngSubmit",function(){return v(c),x(n.startNegotiation())}),o(2,"h1",2),s(3,"Catalog Dataset"),a(),o(4,"div",3)(5,"fieldset",4)(6,"legend",5),s(7,"Catalog Details"),a(),b(8,"lib-json-object-table",6),a(),o(9,"fieldset",4)(10,"legend",5),s(11,"Dataset"),a(),b(12,"lib-json-object-table",6),a()(),o(13,"div",7)(14,"fieldset",8)(15,"legend",5),s(16,"Select an Offer"),a(),T(17,ee,6,5,null,null,R),a(),o(19,"fieldset",9)(20,"legend",5),s(21,"Selected Offer"),a(),m(22,ne,4,2,"div",10)(23,ae,2,0,"div",11),a()(),o(24,"div",12),b(25,"div",13),m(26,oe,1,2,"lib-alert",14),o(27,"button",15)(28,"i",16),s(29,"handshake"),a(),s(30," Negotiate "),a()()()}if(i&2){let c=_t(1);r(8),d("object",n.catalog)("excludeKeys",k(11,zt))("deleteButton",!1),r(4),d("object",n.dataset)("excludeKeys",k(12,Zt))("deleteButton",!1),r(2),d("ngClass",et(13,Xt,!n.offerId)),r(3),F(n.offerKeys),r(2),d("ngClass",et(15,Yt,!n.offerId)),r(3),f(n.offerId?22:23),r(4),d("ngIf",n.errorMsg),r(),d("disabled",c.invalid)}},dependencies:[st,rt,nt,yt,j,at,Dt,ot,xt,it,At,qt,P,q],encapsulation:2})}return e})(),qe=(()=>{class e{stateService;request=new A;requestForm=new vt({counterPartyAddress:new B("",[M.required,M.pattern(Vt)])});constructor(t){this.stateService=t}ngOnInit(){return u(this,null,function*(){(yield W(this.stateService.currentEdcConfig$))?.did?this.requestForm.addControl("counterPartyId",new B("",[M.required,M.pattern(Pt)])):this.requestForm.addControl("counterPartyId",new B(""))})}onRequest(){let t={counterPartyAddress:this.requestForm.value.counterPartyAddress};t.counterPartyId=this.requestForm.value.counterPartyId,this.request.emit(t)}static \u0275fac=function(i){return new(i||e)(y(O))};static \u0275cmp=D({type:e,selectors:[["lib-catalog-request-form"]],outputs:{request:"request"},decls:19,vars:5,consts:[[1,"flex","flex-col","items-center","h-full","overflow-auto",3,"submit","formGroup"],[1,"divider","text-xl","m-0"],[1,"fieldset","w-lg","bg-base-200","border","border-base-300","p-4","rounded-box"],[1,"fieldset-legend","text-sm"],[1,"fieldset-label"],[1,"input","w-full",3,"ngClass"],[1,"material-symbols-rounded","opacity-50"],["type","text","placeholder","Counter Party Address","name","counterPartyAddress","formControlName","counterPartyAddress"],[1,"fieldset-label","text-error"],[1,"divider"],["type","submit",1,"btn","btn-primary","btn-lg","w-lg",3,"disabled"],[1,"material-symbols-rounded"],["type","text","name","counterPartyId","formControlName","counterPartyId",3,"placeholder"]],template:function(i,n){if(i&1&&(o(0,"form",0),C("submit",function(){return n.onRequest()}),o(1,"h1",1),s(2,"Catalog Request"),a(),o(3,"fieldset",2)(4,"legend",3),s(5,"Counter Party"),a(),m(6,ce,11,12),o(7,"legend",4),s(8,"Counter Party Address"),a(),o(9,"label",5)(10,"span",6),s(11,"link"),a(),b(12,"input",7),a(),m(13,de,2,0,"p",8),a(),b(14,"div",9),o(15,"button",10)(16,"span",11),s(17,"auto_stories"),a(),s(18," Request Catalog "),a()()),i&2){let c,g;d("formGroup",n.requestForm),r(6),f(n.requestForm.get("counterPartyId")?6:-1),r(3),d("ngClass",(c=n.requestForm.get("counterPartyAddress"))!=null&&c.invalid?"input-error":""),r(4),f((g=n.requestForm.get("counterPartyAddress"))!=null&&g.invalid?13:-1),r(2),d("disabled",n.requestForm.invalid)}},dependencies:[Tt,rt,nt,j,at,bt,St,P,q],encapsulation:2})}return e})(),Me=(()=>{class e{stateService;modalAndAlertService;destroy$=new G;connectorSelect;showSearchTooltip=!1;federatedCatalog=!1;catalogRequested=new A;protocol="dataspace-protocol-http";selectedConnector;constructor(t,i){this.stateService=t,this.modalAndAlertService=i,this.stateService.currentEdcConfig$.pipe(Q(this.destroy$)).subscribe(this.resetSelector.bind(this))}getCatalog(){if(document.activeElement?.blur(),this.selectedConnector){let t={counterPartyAddress:this.selectedConnector.protocolUrl};this.selectedConnector.did&&(t.counterPartyId=this.selectedConnector.did),this.catalogRequested.emit(t)}}openRequestForm(){this.modalAndAlertService.openModal(qe,void 0,{request:t=>{this.modalAndAlertService.closeModal(),this.getUnknownCatalog(t)}})}getUnknownCatalog(t){this.resetSelector(),this.catalogRequested.emit(t)}resetSelector(){this.selectedConnector=void 0}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(i){return new(i||e)(y(O),y(L))};static \u0275cmp=D({type:e,selectors:[["lib-catalog-request"]],viewQuery:function(i,n){if(i&1&&ut(pe,5),i&2){let c;ft(c=Ct())&&(n.connectorSelect=c.first)}},inputs:{showSearchTooltip:"showSearchTooltip",federatedCatalog:"federatedCatalog"},outputs:{catalogRequested:"catalogRequested"},decls:11,vars:6,consts:[["connectorSelect",""],[1,"flex","w-full","h-full","px-4","gap-3","items-center","rounded-2xl","bg-base-300"],[1,"badge","badge-sm","badge-base","bg-base-100","text-base-content","text-xs","h-[calc(var(--size-field)*6)]"],["data-tip","Select a configured connector here or request the catalog manually",1,"tooltip-open","tooltip-primary","tooltip-bottom","h-full","flex","items-center",3,"ngClass"],[1,"badge","badge-sm","badge-info","badge-soft","text-xs","h-[calc(var(--size-field)*6)]"],[1,"btn","btn-xs","btn-soft","rounded-box","btn-primary","text-xs","h-[calc(var(--size-field)*6)]",3,"click"],[1,"material-symbols-rounded","!text-[.9rem]"],[1,"select","select-ghost","select-xs","bg-base-100","text-base-content","focus:outline-none","focus-within:bg-primary/8","focus-within:text-primary","hover:bg-primary/8","hover:text-primary","hover:cursor-pointer","rounded-box",3,"change","ngModelChange","ngModel"],["disabled","","selected","",3,"ngValue"],[3,"ngValue"]],template:function(i,n){i&1&&(o(0,"div",1)(1,"div",2),s(2),a(),m(3,fe,8,5,"div",3),_(4,"async"),_(5,"async"),m(6,Ce,2,0,"div",4),o(7,"div",5),C("click",function(){return n.openRequestForm()}),o(8,"span",6),s(9,"auto_stories"),a(),s(10," Request Manually "),a()()),i&2&&(r(2),V(" ",n.protocol," "),r(),f(h(4,2,n.stateService.edcConfigs$)&&h(5,4,n.stateService.edcConfigs$).length>1&&!n.federatedCatalog?3:n.federatedCatalog?6:-1))},dependencies:[st,Et,It,wt,j,ot,q,P],encapsulation:2})}return e})(),Ne=(()=>{class e{catalogService;modalAndAlertService;router;negotiationId;pullIntervalMs=500;polling=!0;currentState;stateHistory=[];happyPathStates=["INITIAL","REQUESTED","OFFERED","ACCEPTED","AGREED","VERIFIED","FINALIZED"];happyPath=!0;exceptionStates=["TERMINATED"];errorMsg;statusJob;constructor(t,i,n){this.catalogService=t,this.modalAndAlertService=i,this.router=n}ngOnChanges(){return u(this,null,function*(){this.negotiationId.id&&(this.currentState=(yield this.catalogService.getNegotiationState(this.negotiationId.id)).state,this.stateHistory.length===0&&this.stateHistory.push(this.currentState),this.stopStatusJob(),this.startStatusJob())})}startStatusJob(){this.statusJob=setInterval(this.pullStatus.bind(this),this.pullIntervalMs),this.polling=!0}stopStatusJob(){this.statusJob&&(clearInterval(this.statusJob),this.statusJob=void 0,this.polling=!1)}navigateToContracts(){this.modalAndAlertService.closeModal(),this.router.navigate(["/contracts"])}pullStatus(){return u(this,null,function*(){try{if(this.currentState=(yield this.catalogService.getNegotiationState(this.negotiationId.id)).state,this.stateHistory.length===0||this.stateHistory[this.stateHistory.length-1]!==this.currentState)this.stateHistory.push(this.currentState);else return;this.happyPath&&(this.exceptionStates.includes(this.currentState)?(this.happyPath=!1,this.stopStatusJob()):this.stateHistory=this.happyPathStates.slice(0,this.happyPathStates.indexOf(this.currentState)+1)),this.currentState==="FINALIZED"&&this.stopStatusJob()}catch(t){console.error("Error fetching transfer process status:",t)}})}ngOnDestroy(){this.stopStatusJob()}TransferProcessStates=S.TransferProcessStates;static \u0275fac=function(i){return new(i||e)(y(lt),y(L),y(ht))};static \u0275cmp=D({type:e,selectors:[["lib-negotiation-progress"]],inputs:{negotiationId:"negotiationId",pullIntervalMs:"pullIntervalMs"},features:[Z],decls:9,vars:4,consts:[[1,"flex","flex-col","items-center"],[1,"text-3xl","mb-10"],[1,"steps","wider-steps"],[1,"loading","loading-bars","loading-xl","mt-10"],["role","alert",1,"alert","alert-error","alert-soft","mt-10","max-w-xl"],["role","button",1,"btn","btn-success","btn-soft","mt-10"],[1,"step","before:transition-colors","before:duration-300","after:transition-colors","after:duration-300",3,"ngClass"],[1,"material-symbols-rounded"],[1,"break-all"],[1,"font-bold"],["role","button",1,"btn","btn-success","btn-soft","mt-10",3,"click"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"h1",1),s(2,"Contract Negotiation"),a(),o(3,"ul",2),m(4,he,2,0)(5,xe,2,0),a(),m(6,ye,1,0,"span",3)(7,be,8,1,"div",4)(8,Se,4,0,"div",5),a()),i&2&&(r(4),f(n.happyPath?4:5),r(2),f(n.polling?6:-1),r(),f(n.errorMsg?7:-1),r(),f(n.happyPath&&n.currentState==="FINALIZED"?8:-1))},dependencies:[P],encapsulation:2})}return e})(),ze=(()=>{class e{stateService;catalogService;modalAndAlertService;destroy$=new G;catalogDatasets$=I([]);filteredCatalogDatasets$=I([]);pageCatalogDatasets$=I([]);hasCatalogDatasets$=new H(!1);pageItemCount=15;catalogViewState={isLoading:!1,showSearchTooltip:!0,emptyCatalogMsg:"No catalog has been requested yet..."};isFederatedCatalogEnabled=!1;errorMsg="";constructor(t,i,n){this.stateService=t,this.catalogService=i,this.modalAndAlertService=n}ngOnInit(){return u(this,null,function*(){this.stateService.currentEdcConfig$.pipe(Q(this.destroy$)).subscribe(()=>u(this,null,function*(){this.catalogDatasets$=this.filteredCatalogDatasets$=I([]),this.hasCatalogDatasets$.next(!1),(yield W(this.stateService.isFederatedCatalogEnabled$))?(this.isFederatedCatalogEnabled=!0,yield this.getFederatedCatalogs()):(this.isFederatedCatalogEnabled=!1,this.resetCatalogViewState())}))})}getFederatedCatalogs(){return u(this,null,function*(){this.catalogViewState.isLoading=!0,this.catalogDatasets$=U(this.catalogService.getAllCatalogDatasets()).pipe(z(t=>{this.hasCatalogDatasets$.next((t??[]).length>0),this.updateCatalogDatasetState(t,!0,"")}),K(()=>{this.catalogViewState.isLoading=!1})),this.filteredCatalogDatasets$=this.catalogDatasets$})}getCatalog(t){return u(this,null,function*(){if(t.counterPartyAddress)return yield this.getCatalogByAddress(t);if(!t.counterPartyAddress&&this.isFederatedCatalogEnabled)return yield this.getFederatedCatalogs()})}getCatalogByAddress(t){return u(this,null,function*(){this.catalogViewState.isLoading=!0,this.catalogDatasets$=U(this.catalogService.getCatalogDataset(t)).pipe(z(i=>{this.hasCatalogDatasets$.next((i??[]).length>0),this.updateCatalogDatasetState(i,!1,"",t.counterPartyAddress)}),dt(i=>(this.errorMsg=i?.message||`Failed to request catalog from '${t.counterPartyAddress}'`,this.hasCatalogDatasets$.next(!1),this.updateCatalogDatasetState([],!1,this.errorMsg,t.counterPartyAddress),this.modalAndAlertService.showAlert(this.errorMsg,"Failed to request catalog","error",5),I([]))),K(()=>{this.catalogViewState.isLoading=!1})),this.filteredCatalogDatasets$=this.catalogDatasets$})}updateCatalogDatasetState(t,i,n,c=""){let g=t.length===0,J=g&&!n?i?"Empty catalog! Federated catalog has no dataset.":`Empty catalog! The counter party '${c}' has no dataset.`:n||this.catalogViewState.emptyCatalogMsg;this.catalogViewState.showSearchTooltip=i?g:!1,this.catalogViewState.emptyCatalogMsg=J}filter(t){if(t){let i=t.toLowerCase();this.filteredCatalogDatasets$=this.catalogDatasets$.pipe(ct(n=>n.filter(c=>c.assetId.toLowerCase().includes(i)||c.participantId.toLowerCase().includes(i))))}else this.filteredCatalogDatasets$=this.catalogDatasets$}paginationEvent(t){this.pageCatalogDatasets$=I(t)}openDetails(t){this.modalAndAlertService.openModal(Mt,{jsonLdObject:t.dataset})}negotiateContract(t){let i={negotiationRequested:n=>{this.modalAndAlertService.openModal(Ne,{negotiationId:n},void 0,!0)}};this.modalAndAlertService.openModal(Pe,{catalogDataset:t},i)}resetCatalogViewState(){this.catalogViewState.showSearchTooltip=!0,this.catalogViewState.emptyCatalogMsg="No catalog has been requested yet..."}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(i){return new(i||e)(y(O),y(lt),y(L))};static \u0275cmp=D({type:e,selectors:[["lib-catalog-view"]],decls:9,vars:10,consts:[[1,"flex","flex-row","flex-nowrap","mb-4"],["placeholder","Filter for Asset ID or Provider name ...",1,"flex-1","mr-4","grow",3,"inputChange","focusShortcut"],[1,"mr-4",3,"catalogRequested","showSearchTooltip","federatedCatalog"],[1,"mr-4",3,"itemCountChanged","currentItemCount"],[1,"shadow-xl","rounded-2xl","bg-base-300","[&_button:hover]:bg-base-100","[&_.join>button]:first:rounded-l-2xl","[&_.join>button]:last:rounded-r-2xl",3,"pageItems","items","pageItemCount"],[1,"grid","w-full","gap-4","sm:grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","2xl:grid-cols-5"],[1,"skeleton","flex","justify-center","items-center","h-72","shadow-xl","rounded-2xl"],[1,"loading","loading-bars","loading-lg","opacity-75","text-primary"],[1,"flex","flex-col","items-center","justify-center","w-full","h-full","p-6","text-sm","text-center","space-y-4","mt-4","opacity-55","transition-opacity","duration-500"],[1,"rounded-2xl","shadow-xl","[&_>.card]:h-full",3,"catalogDataset"],[1,"rounded-2xl","shadow-xl","[&_>.card]:h-full",3,"detailsEvent","negotiateEvent","catalogDataset"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"lib-filter-input",1),C("inputChange",function(g){return n.filter(g)}),a(),o(2,"lib-catalog-request",2),C("catalogRequested",function(g){return n.getCatalog(g)}),a(),o(3,"lib-item-count-selector",3),C("itemCountChanged",function(g){return n.pageItemCount=g}),a(),o(4,"lib-pagination",4),_(5,"async"),C("pageItems",function(g){return n.paginationEvent(g)}),a()(),o(6,"div",5),m(7,Ie,2,0,"div",6)(8,Ae,3,3),a()),i&2&&(r(),d("focusShortcut",k(9,we)),r(),d("showSearchTooltip",n.catalogViewState.showSearchTooltip)("federatedCatalog",n.isFederatedCatalogEnabled),r(),d("currentItemCount",n.pageItemCount),r(),d("items",h(5,7,n.filteredCatalogDatasets$))("pageItemCount",15),r(3),f(n.catalogViewState.isLoading?7:8))},dependencies:[q,Nt,$t,Ve,Me,Rt],encapsulation:2})}return e})();export{qe as CatalogRequestFormComponent,lt as CatalogService,ze as CatalogViewComponent};
