import{$a as me,Aa as X,B as M,C as _,Ca as Y,Da as Z,F as y,H as I,Ha as ee,Ia as te,Ja as ie,K as W,Ka as ne,L,M as i,Ma as oe,N as n,Na as le,O as k,Pa as be,Qa as re,R as b,Ra as se,S as f,Sa as ae,T as m,Ta as ce,X as q,Y as r,Ya as de,Z as x,_a as pe,aa as E,ab as ye,ba as P,bb as ue,c as _e,ca as D,d as h,da as U,e as $,ea as G,fa as V,g as A,ga as T,h as w,j as N,ka as R,m as F,ma as O,na as z,o as j,p as B,r as J,s as d,t as p,va as H,w as v,xa as K,y as a,ya as Q,z as S}from"./chunk-NSHOW2UM.js";var C=_e(be(),1);var Ce=l=>({"select-error":l});function we(l,u){l&1&&(i(0,"p",18),r(1,"Mandatory"),n())}function ve(l,u){if(l&1){let e=b();i(0,"lib-alert",28),f("closeEvent",function(){d(e);let t=m();return p(t.errorMsg="")}),n()}if(l&2){let e=m();y("msg",e.errorMsg)}}function Se(l,u){if(l&1){let e=b();i(0,"button",29),f("click",function(){d(e);let t=m();return p(t.createPolicyDefinition())}),i(1,"i",30),r(2,"add"),n(),r(3," Create Policy "),n()}if(l&2){m();let e=q(1);y("disabled",e.invalid)}}function xe(l,u){if(l&1){let e=b();i(0,"button",31),f("click",function(){d(e);let t=m();return p(t.editPolicyDefinition())}),i(1,"i",30),r(2,"update"),n(),r(3," Update Policy "),n()}}function Ee(l,u){if(l&1&&(i(0,"div",7)(1,"span",8),r(2,"question_exchange"),n(),i(3,"b")(4,"i"),r(5,"Policy Type"),n()()(),i(6,"div",9)(7,"span"),r(8),n()()),l&2){let e=m(2);a(8),x(e.policyType)}}function Pe(l,u){if(l&1){let e=b();i(0,"div",12)(1,"div",13)(2,"button",14),f("click",function(){d(e);let t=m(2);return p(t.detailsEvent.emit(t.policyDefinition))}),i(3,"i",10),r(4,"info"),n()()(),i(5,"div",15)(6,"button",16),f("click",function(){d(e);let t=m(2);return p(t.editEvent.emit(t.policyDefinition))}),i(7,"i",10),r(8,"edit"),n()()(),i(9,"div",17)(10,"button",18),f("click",function(){d(e);let t=m(2);return p(t.deleteEvent.emit(t.policyDefinition))}),i(11,"i",10),r(12,"delete"),n()()()()}}function De(l,u){if(l&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),r(4,"policy"),n(),i(5,"span",5),r(6),n()(),i(7,"div",6),_(8,Ee,9,1),i(9,"div",7)(10,"span",8),r(11,"rule"),n(),i(12,"b")(13,"i"),r(14,"Permissions"),n()()(),i(15,"div",9)(16,"span",10),r(17),n()(),i(18,"div",7)(19,"span",8),r(20,"rule"),n(),i(21,"b")(22,"i"),r(23,"Prohibitions"),n()()(),i(24,"div",9)(25,"span",10),r(26),n()(),i(27,"div",7)(28,"span",8),r(29,"rule"),n(),i(30,"b")(31,"i"),r(32,"Obligations"),n()()(),i(33,"div",9)(34,"span",10),r(35),n()()(),_(36,Pe,13,0,"div",11),n()()),l&2){let e=m();a(6),x(e.policyDefinition==null?null:e.policyDefinition["@id"]),a(2),I(e.policyType?8:-1),a(9),x(e.hasPermissions?"check":"close"),a(9),x(e.hasProhibitions?"check":"close"),a(9),x(e.hasObligations?"check":"close"),a(),y("ngIf",e.showButtons)}}var Ie=()=>["Alt","j"],Me=(l,u)=>u.id;function Ve(l,u){if(l&1){let e=b();i(0,"lib-policy-card",9),f("detailsEvent",function(t){d(e);let s=m();return p(s.openDetails(t))})("editEvent",function(t){d(e);let s=m();return p(s.editPolicy(t))})("deleteEvent",function(t){d(e);let s=m();return p(s.deletePolicy(t))}),n()}if(l&2){let e=u.$implicit;y("policyDefinition",e)}}function Te(l,u){l&1&&k(0,"span",10)}function Ae(l,u){if(l&1){let e=b();i(0,"div",11)(1,"button",12),f("click",function(){d(e);let t=m(2);return p(t.createPolicy())}),i(2,"span",3),r(3,"add"),n(),r(4," Create "),n()()}}function Je(l,u){if(l&1&&(i(0,"div",8),_(1,Te,1,0,"span",10)(2,Ae,5,0,"div",11),n()),l&2){let e=m();a(),I(e.fetched?2:1)}}var he=(()=>{class l{edc;constructor(e){this.edc=e}getAllPolicies(){return h(this,null,function*(){return(yield this.edc.getClient()).management.policyDefinitions.queryAll()})}createPolicyDefinition(e){return h(this,null,function*(){return(yield this.edc.getClient()).management.policyDefinitions.create(e)})}updatePolicy(e,o){return h(this,null,function*(){return(yield this.edc.getClient()).management.policyDefinitions.update(e,o)})}deletePolicy(e){return h(this,null,function*(){return(yield this.edc.getClient()).management.policyDefinitions.delete(e)})}static \u0275fac=function(o){return new(o||l)(B(re))};static \u0275prov=j({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})(),fe=(()=>{class l{policyService;formBuilder;Object=Object;policyDefinition;created=new v;updated=new v;mode="create";errorMsg="";id="";policyType;permissionsJson="";prohibitionsJson="";obligationsJson="";policyForm;constructor(e,o){this.policyService=e,this.formBuilder=o,this.policyForm=this.formBuilder.group({id:[""],policyType:[""]})}ngOnChanges(){return h(this,null,function*(){if(this.policyDefinition){let e=yield(0,C.compact)(this.policyDefinition.policy);this.mode="update",this.id=this.policyDefinition["@id"];let o=e["@type"].split("/");this.policyType=o[o.length-1],this.policyDefinition.policy.permissions.length>0&&(this.permissionsJson=JSON.stringify(yield(0,C.compact)(this.policyDefinition.policy.permissions))),this.policyDefinition.policy.prohibitions.length>0&&(this.prohibitionsJson=JSON.stringify(yield(0,C.compact)(this.policyDefinition.policy.prohibitions))),this.policyDefinition.policy.obligations.length>0&&(this.obligationsJson=JSON.stringify(yield(0,C.compact)(this.policyDefinition.policy.obligations)))}})}createPolicyDefinition(){try{let e=this.createPolicyInput();this.policyService.createPolicyDefinition(e).then(o=>{this.created.emit(o)}).catch(o=>{this.errorMsg=o.message})}catch(e){e instanceof Error?this.errorMsg=e.message:this.errorMsg="An unknown error occurred."}}editPolicyDefinition(){try{let e=this.createPolicyInput();this.policyService.updatePolicy(e.id,e).then(()=>this.updated.emit()).catch(o=>{this.errorMsg=o.message})}catch(e){e instanceof Error?this.errorMsg=e.message:this.errorMsg="An unknown error occurred."}}createPolicyInput(){let e={"@type":this.policyType};try{this.permissionsJson&&this.permissionsJson!==""&&(e.permission=JSON.parse(this.permissionsJson))}catch(s){throw s instanceof Error?new Error(`Invalid JSON for permissions: ${s.message}`):new Error("An unknown error occurred during permissions JSON parsing.")}try{this.prohibitionsJson&&this.prohibitionsJson!==""&&(e.prohibition=JSON.parse(this.prohibitionsJson))}catch(s){throw s instanceof Error?new Error(`Invalid JSON for prohibitions: ${s.message}`):new Error("An unknown error occurred during prohibitions JSON parsing.")}try{this.obligationsJson&&this.obligationsJson!==""&&(e.obligation=JSON.parse(this.obligationsJson))}catch(s){throw s instanceof Error?new Error(`Invalid JSON for obligations: ${s.message}`):new Error("An unknown error occurred during obligations JSON parsing.")}let o;this.policyType?o=new C.PolicyBuilder().type(this.policyType).raw(e).build():o=new C.PolicyBuilder().type("Set").raw(e).build();let t={policy:o};return this.id&&(t.id=this.id,t["@id"]=this.id),t}static \u0275fac=function(o){return new(o||l)(S(he),S(oe))};static \u0275cmp=M({type:l,selectors:[["lib-policy-create"]],inputs:{policyDefinition:"policyDefinition"},outputs:{created:"created",updated:"updated"},features:[J],decls:64,vars:13,consts:[["policyForm","ngForm"],[1,"grid","grid-cols-1","gap-4","items-start","overflow-y-auto","h-full"],[1,"text-xl","text-center","divider","m-0"],[1,"flex","flex-col"],[1,"fieldset","w-lg","bg-base-200","border","border-base-300","p-4","rounded-box"],[1,"fieldset-legend","text-sm"],[1,"fieldset-label"],["data-tip","If not set a random UUID will be generated",1,"input","input-bordered","!border-[var(--input-color)]","flex","items-center","tooltip","tooltip-info","tooltip-top","w-full"],[1,"material-symbols-rounded","opacity-50"],["type","text","placeholder","ID","name","id",1,"w-full",3,"ngModelChange","ngModel","disabled"],[1,"badge","badge-info"],[1,"select","w-full",3,"ngClass"],[1,"label"],["name","policyType","required","",1,"select","w-full",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["value","Set"],["value","Offer"],["value","Contract"],[1,"fieldset-label","text-error"],["data-tip","Expects JSON",1,"input","flex","items-center","tooltip","tooltip-info","tooltip-top","w-full"],["type","text","placeholder","Permissions","name","permissionsJson",1,"grow",3,"ngModelChange","ngModel"],["type","text","placeholder","Prohibitions","name","prohibitionsJson",1,"grow",3,"ngModelChange","ngModel"],["type","text","placeholder","Obligations","name","obligationsJson",1,"grow",3,"ngModelChange","ngModel"],[1,"flex","flex-col","items-center"],[1,"divider","mt-0"],["title","Error","type","error","class","w-lg mb-4",3,"msg","closeEvent",4,"ngIf"],["class","btn btn-lg btn-primary w-lg",3,"disabled","click",4,"ngIf"],["class","btn btn-lg btn-warning w-lg",3,"click",4,"ngIf"],["title","Error","type","error",1,"w-lg","mb-4",3,"closeEvent","msg"],[1,"btn","btn-lg","btn-primary","w-lg",3,"click","disabled"],[1,"material-symbols-rounded"],[1,"btn","btn-lg","btn-warning","w-lg",3,"click"]],template:function(o,t){if(o&1){let s=b();i(0,"form",1,0)(2,"h1",2),r(3,"Policy"),n(),i(4,"div",3)(5,"fieldset",4)(6,"legend",5),r(7,"Common Fields"),n(),i(8,"legend",6),r(9,"ID"),n(),i(10,"label",7)(11,"span",8),r(12,"deployed_code_update"),n(),i(13,"input",9),D("ngModelChange",function(c){return d(s),P(t.id,c)||(t.id=c),p(c)}),n(),i(14,"span",10),r(15,"Optional"),n()(),i(16,"legend",6),r(17,"Policy-Type"),n(),i(18,"label",11)(19,"span",12),r(20,"Type"),n(),i(21,"select",13),D("ngModelChange",function(c){return d(s),P(t.policyType,c)||(t.policyType=c),p(c)}),i(22,"option",14),r(23,"Select a type"),n(),i(24,"option",15),r(25,"Set"),n(),i(26,"option",16),r(27,"Offer"),n(),i(28,"option",17),r(29,"Contract"),n()()(),_(30,we,2,0,"p",18),n()(),i(31,"div",3)(32,"fieldset",4)(33,"legend",5),r(34,"Properties"),n(),i(35,"legend",6),r(36,"Permissions"),n(),i(37,"label",19)(38,"span",8),r(39,"file_json"),n(),i(40,"input",20),D("ngModelChange",function(c){return d(s),P(t.permissionsJson,c)||(t.permissionsJson=c),p(c)}),n(),i(41,"span",10),r(42,"Optional"),n()(),i(43,"legend",6),r(44,"Prohibitions"),n(),i(45,"label",19)(46,"span",8),r(47,"file_json"),n(),i(48,"input",21),D("ngModelChange",function(c){return d(s),P(t.prohibitionsJson,c)||(t.prohibitionsJson=c),p(c)}),n(),i(49,"span",10),r(50,"Optional"),n()(),i(51,"legend",6),r(52,"Obligations"),n(),i(53,"label",19)(54,"span",8),r(55,"file_json"),n(),i(56,"input",22),D("ngModelChange",function(c){return d(s),P(t.obligationsJson,c)||(t.obligationsJson=c),p(c)}),n(),i(57,"span",10),r(58,"Optional"),n()()()(),i(59,"div",23),k(60,"div",24),_(61,ve,1,1,"lib-alert",25)(62,Se,4,1,"button",26)(63,xe,4,0,"button",27),n()()}o&2&&(a(13),E("ngModel",t.id),y("disabled",t.mode==="update"),a(5),y("ngClass",G(11,Ce,!t.policyType)),a(3),E("ngModel",t.policyType),a(9),I(t.policyType?-1:30),a(10),E("ngModel",t.permissionsJson),a(8),E("ngModel",t.prohibitionsJson),a(8),E("ngModel",t.obligationsJson),a(5),y("ngIf",t.errorMsg),a(),y("ngIf",t.mode==="create"),a(),y("ngIf",t.mode==="update"))},dependencies:[le,Z,te,ie,H,ee,K,Q,ne,Y,X,O,ae,R],encapsulation:2})}return l})(),ge=(()=>{class l{policyDefinition;showButtons=!0;detailsEvent=new v;editEvent=new v;deleteEvent=new v;id;policy;policyType;hasPermissions=!1;hasProhibitions=!1;hasObligations=!1;ngOnChanges(){this.id=this.policyDefinition?.id,this.policy=this.policyDefinition?.policy;let e=this.policy.types();e&&e.length>0&&(this.policyType=e[0].split("/").pop()),this.policy&&this.policy.permissions.length>0&&(this.hasPermissions=!0),this.policy&&this.policy.prohibitions.length>0&&(this.hasProhibitions=!0),this.policy&&this.policy.obligations.length>0&&(this.hasObligations=!0)}static \u0275fac=function(o){return new(o||l)};static \u0275cmp=M({type:l,selectors:[["lib-policy-card"]],inputs:{policyDefinition:"policyDefinition",showButtons:"showButtons"},outputs:{detailsEvent:"detailsEvent",editEvent:"editEvent",deleteEvent:"deleteEvent"},features:[J],decls:1,vars:1,consts:[["class","card grow bg-base-300",4,"ngIf"],[1,"card","grow","bg-base-300"],[1,"card-body"],[1,"card-title","mb-3"],[1,"material-symbols-rounded","!text-3xl"],[1,"truncate","text-wrap"],[1,"ml-3","mb-3","grid","grid-cols-[minmax(0,auto)_minmax(0,min-content)]","gap-4"],[1,"flex","items-center"],[1,"material-symbols-rounded","mr-1"],[1,"truncate"],[1,"material-symbols-rounded"],["class","card-actions justify-end mt-auto",4,"ngIf"],[1,"card-actions","justify-end","mt-auto"],["data-tip","Details",1,"tooltip","no-animation"],[1,"btn","btn-soft","btn-primary","btn-circle","btn-sm","no-animation",3,"click"],["data-tip","Edit",1,"tooltip","no-animation"],[1,"btn","btn-soft","btn-warning","btn-circle","btn-sm","no-animation",3,"click"],["data-tip","Delete",1,"tooltip","no-animation"],[1,"btn","btn-soft","btn-error","btn-circle","btn-sm",3,"click"]],template:function(o,t){o&1&&_(0,De,37,6,"div",0),o&2&&y("ngIf",t.policyDefinition)},dependencies:[O],encapsulation:2})}return l})(),Re=(()=>{class l{policyService;modalAndAlertService;stateService;destroy$=new $;policies$=w([]);filteredPolicies$=w([]);pagePolicies$=w([]);fetched=!1;pageItemCount=15;constructor(e,o,t){this.policyService=e,this.modalAndAlertService=o,this.stateService=t,this.stateService.currentEdcConfig$.pipe(F(this.destroy$)).subscribe(this.fetchPolicies.bind(this))}ngOnInit(){return h(this,null,function*(){this.fetchPolicies()})}openDetails(e){return h(this,null,function*(){this.modalAndAlertService.openModal(pe,{jsonLdObject:e})})}filter(e){if(e){let o=e.toLowerCase();this.filteredPolicies$=this.policies$.pipe(N(t=>t.filter(s=>s.id.includes(o))))}else this.filteredPolicies$=this.policies$}paginationEvent(e){this.pagePolicies$=w(e)}createPolicy(){let e={created:o=>{this.modalAndAlertService.closeModal(),this.modalAndAlertService.showAlert(`Policy with ID '${o["@id"]}'`,"Created Successfully","success",5),this.fetchPolicies()}};this.modalAndAlertService.openModal(fe,void 0,e)}editPolicy(e){return h(this,null,function*(){let o={updated:()=>{this.modalAndAlertService.closeModal(),this.modalAndAlertService.showAlert(`Policy with ID '${e.id}'`,"updated successfully","success",5),this.fetchPolicies()}};this.modalAndAlertService.openModal(fe,{policyDefinition:e},o)})}deletePolicy(e){this.modalAndAlertService.openModal(de,{customText:"Do you really want to delete this Policy?",componentType:ge,componentInputs:{policyDefinition:e,showButtons:!1}},{canceled:()=>this.modalAndAlertService.closeModal(),confirm:()=>{this.modalAndAlertService.closeModal(),this.policyService.deletePolicy(e.id).then(()=>{let o=`Policy '${e.id}' deleted successfully`;this.modalAndAlertService.showAlert(o,void 0,"success",5),this.policies$=this.filteredPolicies$=A(this.policyService.getAllPolicies())}).catch(o=>{console.error(o);let t=`Deletion of asset '${e.id}' failed`;this.modalAndAlertService.showAlert(t,void 0,"error",5)})}})}fetchPolicies(){this.fetched=!1,this.policies$=this.filteredPolicies$=w([]),this.policies$=this.filteredPolicies$=A(this.policyService.getAllPolicies().finally(()=>this.fetched=!0))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(o){return new(o||l)(S(he),S(ce),S(se))};static \u0275cmp=M({type:l,selectors:[["lib-policy-view"]],decls:15,vars:12,consts:[[1,"flex-row","flex-nowrap","flex","mb-4"],["placeholder","Filter for ID ...",1,"mr-4","grow",3,"inputChange","focusShortcut"],[1,"mr-4","btn","btn-lg","btn-primary","rounded-2xl","btn-soft","shadow-xl","!text-sm","border-none",3,"click"],[1,"material-symbols-rounded"],[1,"mr-4",3,"itemCountChanged","currentItemCount"],[1,"shadow-xl","rounded-2xl","bg-base-300","[&_button:hover]:bg-base-100","[&_.join>button]:first:rounded-l-2xl","[&_.join>button]:last:rounded-r-2xl",3,"pageItems","items","pageItemCount"],[1,"grid","w-full","gap-4","sm:grid-cols-1","md:grid-cols-2","lg:grid-cols-3","xl:grid-cols-4","2xl:grid-cols-5"],[1,"rounded-2xl","shadow-xl","[&_>.card]:h-full",3,"policyDefinition"],[1,"skeleton","flex","justify-center","items-center","h-72","shadow-xl","rounded-2xl"],[1,"rounded-2xl","shadow-xl","[&_>.card]:h-full",3,"detailsEvent","editEvent","deleteEvent","policyDefinition"],[1,"loading","loading-bars","loading-lg","opacity-75","text-primary"],["data-tip","No policies yet! Create your first policy.",1,"tooltip","tooltip-open","tooltip-primary"],[1,"btn","btn-primary","btn-dash",3,"click"]],template:function(o,t){if(o&1&&(i(0,"div",0)(1,"lib-filter-input",1),f("inputChange",function(g){return t.filter(g)}),n(),i(2,"button",2),f("click",function(){return t.createPolicy()}),i(3,"span",3),r(4,"add"),n(),r(5," Create "),n(),i(6,"lib-item-count-selector",4),f("itemCountChanged",function(g){return t.pageItemCount=g}),n(),i(7,"lib-pagination",5),V(8,"async"),f("pageItems",function(g){return t.paginationEvent(g)}),n()(),i(9,"div",6),W(10,Ve,1,1,"lib-policy-card",7,Me),V(12,"async"),_(13,Je,3,1,"div",8),V(14,"async"),n()),o&2){let s;a(),y("focusShortcut",U(11,Ie)),a(5),y("currentItemCount",t.pageItemCount),a(),y("items",T(8,5,t.filteredPolicies$))("pageItemCount",15),a(3),L(T(12,7,t.pagePolicies$)),a(3),I(((s=T(14,9,t.policies$))==null?null:s.length)===0?13:-1)}},dependencies:[z,me,ye,ge,ue],encapsulation:2})}return l})();export{ge as PolicyCardComponent,fe as PolicyCreateComponent,he as PolicyService,Re as PolicyViewComponent};
