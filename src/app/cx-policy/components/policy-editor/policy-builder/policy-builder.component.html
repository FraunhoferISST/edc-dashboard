<!--
    Copyright (c) 2025 Fraunhofer-Gesellschaft zur Förderung der angewandten Forschung e.V.

    This program and the accompanying materials are made available under the
    terms of the Apache License, Version 2.0 which is available at
    https://www.apache.org/licenses/LICENSE-2.0

    SPDX-License-Identifier: Apache-2.0

    Contributors:
        Fraunhofer-Gesellschaft zur Förderung der angewandten Forschung e.V. - Catena-X Next Policy Builder
-->

<div class="w-full h-full grid grid-cols-[auto_1fr] gap-4 pb-4">
  <ul class="menu bg-base-100 rounded-2xl pr-3">
    <li>
      <h2 class="menu-title flex justify-between pr-0">
        <span>Permission(s)</span>
        <button
          class="btn btn-primary btn-outline btn-xs btn-soft ml-2"
          (click)="addRule('Permission')"
          title="Add permission"
        >
          <span class="material-symbols-rounded !text-[1.2rem]">add</span>
        </button>
      </h2>
      <ul>
        @for (permission of policyConfig.policy.permissions; track permission.name) {
          <div class="group flex flex-row justify-between flex-nowrap items-center">
            <li class="w-40 mr-2" (click)="onRuleSelectionChange(permission, 'Permission')">
              <a [class.text-primary]="permission === currentPermission">{{ permission.name }}</a>
            </li>
            <button
              class="btn btn-error btn-outline btn-xs btn-soft invisible group-hover:visible"
              (click)="removeRule(permission, 'Permission')"
              title="Delete permission"
            >
              <span class="material-symbols-rounded !text-[1.2rem]">delete</span>
            </button>
          </div>
        }
      </ul>
    </li>
    @if (policyConfig.policy.type === Action.Use) {
      <li>
        <h2 class="menu-title flex justify-between pr-0">
          <span>Obligation(s)</span>
          <button
            class="btn btn-primary btn-outline btn-xs btn-soft ml-2"
            (click)="addRule('Obligation')"
            title="Add permission"
          >
            <span class="material-symbols-rounded !text-[1.2rem]">add</span>
          </button>
        </h2>
        <ul>
          @for (obligation of policyConfig.policy.obligations; track obligation.name) {
            <div class="group flex flex-row justify-between flex-nowrap items-center">
              <li class="w-40 mr-2" (click)="onRuleSelectionChange(obligation, 'Obligation')">
                <a [class.text-primary]="obligation === currentPermission">{{ obligation.name }}</a>
              </li>
              <button
                class="btn btn-error btn-outline btn-xs btn-soft invisible group-hover:visible"
                (click)="removeRule(obligation, 'Obligation')"
                title="Delete permission"
              >
                <span class="material-symbols-rounded !text-[1.2rem]">delete</span>
              </button>
            </div>
          }
        </ul>
      </li>
      <li>
        <h2 class="menu-title flex justify-between pr-0">
          <span>Prohibition(s)</span>
          <button
            class="btn btn-primary btn-outline btn-xs btn-soft ml-2"
            (click)="addRule('Prohibition')"
            title="Add permission"
          >
            <span class="material-symbols-rounded !text-[1.2rem]">add</span>
          </button>
        </h2>
        <ul>
          @for (prohibition of policyConfig.policy.prohibitions; track prohibition.name) {
            <div class="group flex flex-row justify-between flex-nowrap items-center">
              <li class="w-40 mr-2" (click)="onRuleSelectionChange(prohibition, 'Prohibition')">
                <a [class.text-primary]="prohibition === currentPermission">{{ prohibition.name }}</a>
              </li>
              <button
                class="btn btn-error btn-outline btn-xs btn-soft invisible group-hover:visible"
                (click)="removeRule(prohibition, 'Prohibition')"
                title="Delete permission"
              >
                <span class="material-symbols-rounded !text-[1.2rem]">delete</span>
              </button>
            </div>
          }
        </ul>
      </li>
    }
  </ul>

  <app-permission
    *ngIf="currentPermission && constraintTemplates"
    (permissionChange)="onRuleChange()"
    [permission]="currentPermission"
    [constraints]="constraintTemplates"
    class="max-w-full"
  ></app-permission>
</div>
